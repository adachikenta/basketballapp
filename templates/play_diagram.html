{% extends "base.html" %}
{% block title %}{{ _('play_diagram_editor') }}{% endblock %}
{% block extra_head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<style>
    .play-editor-container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .toolbar {
        width: 200px;
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .toolbar h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #0da12e;
        font-size: 1.1em;
    }
    
    .toolbar-section {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .toolbar-section:last-child {
        border-bottom: none;
    }
    
    .tool-button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 8px;
        background-color: #ffffff;
        border: 2px solid #dee2e6;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
    }
    
    .tool-button:hover {
        background-color: #e9ecef;
        border-color: #0da12e;
    }
    
    .tool-button.active {
        background-color: #0da12e;
        color: #ffffff;
        border-color: #0da12e;
    }
    
    .canvas-container {
        flex: 1;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    #court-canvas {
        border: 2px solid #dee2e6;
        border-radius: 5px;
    }
    
    .diagram-info {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
    }
    
    .diagram-info input,
    .diagram-info textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }
    
    .diagram-info textarea {
        resize: vertical;
        min-height: 60px;
    }
    
    .diagram-info label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
        color: #333;
    }
    
    .action-buttons {
        margin-top: 15px;
        display: flex;
        gap: 10px;
    }
    
    .action-buttons button {
        flex: 1;
    }
    
    .instructions {
        background-color: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 5px;
        padding: 15px;
        margin-top: 20px;
    }
    
    .instructions h4 {
        margin-top: 0;
        margin-bottom: 10px;
        color: #856404;
        cursor: pointer;
        user-select: none;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .instructions h4:hover {
        opacity: 0.8;
    }
    
    .toggle-icon {
        font-size: 0.8em;
        transition: transform 0.3s;
    }
    
    .toggle-icon.expanded {
        transform: rotate(90deg);
    }
    
    .instructions-content {
        display: none;
        overflow: hidden;
    }
    
    .instructions-content.show {
        display: block;
    }
    
    .instructions ul {
        margin: 10px 0;
        padding-left: 20px;
    }
    
    .instructions li {
        margin-bottom: 5px;
        color: #856404;
    }
</style>
{% endblock %}
{% block content %}
<div class="play-editor-container">
    <div class="toolbar">
        <div class="toolbar-section">
            <h3>ğŸ“ ãƒ„ãƒ¼ãƒ«</h3>
            <button class="tool-button active" onclick="setMode('select')">âœ‹ é¸æŠãƒ¢ãƒ¼ãƒ‰</button>
            <button class="tool-button" onclick="setMode('player')">ğŸ”µ é¸æ‰‹è¿½åŠ </button>
            <button class="tool-button" onclick="setMode('opponent')">ğŸ”´ ç›¸æ‰‹é¸æ‰‹è¿½åŠ </button>
            <button class="tool-button" onclick="setMode('arrow')">â¡ï¸ å‹•ãçŸ¢å°ï¼ˆæ›²ç·šï¼‰</button>
            <button class="tool-button" onclick="setMode('pass')">ğŸ€ ãƒ‘ã‚¹çŸ¢å°ï¼ˆç›´ç·šï¼‰</button>
            <button class="tool-button" onclick="setMode('text')">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ </button>
        </div>
        
        <div class="toolbar-section">
            <h3>ğŸ—‘ï¸ ç·¨é›†</h3>
            <button class="tool-button" onclick="deleteSelected()">ğŸ—‘ï¸ é¸æŠã‚’å‰Šé™¤</button>
            <button class="tool-button" onclick="clearCanvas()">ğŸ§¹ å…¨ã¦ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div class="toolbar-section">
            <h3>ğŸ’¾ ä¿å­˜</h3>
            <button class="tool-button" onclick="saveDiagram()">ğŸ’¾ ä¿å­˜</button>
            <button class="tool-button" onclick="window.location.href='/play/list'">ğŸ“‹ ä¸€è¦§ã«æˆ»ã‚‹</button>
        </div>
    </div>
    
    <div class="canvas-container">
        <div class="diagram-info">
            <input type="hidden" id="diagram-id" value="">
            <label>
                ãƒ—ãƒ¬ãƒ¼å:
                <input type="text" id="diagram-name" placeholder="ä¾‹: ãƒ”ãƒƒã‚¯&ãƒ­ãƒ¼ãƒ«åŸºæœ¬" required>
            </label>
            <label>
                èª¬æ˜:
                <textarea id="diagram-description" placeholder="ãƒ—ãƒ¬ãƒ¼ã®ç›®çš„ã‚„ãƒã‚¤ãƒ³ãƒˆã‚’è¨˜å…¥"></textarea>
            </label>
        </div>
        
        <canvas id="court-canvas" width="800" height="600"></canvas>
    </div>
</div>
<div class="instructions">
    <h4 onclick="toggleInstructions()">
        <span class="toggle-icon">â–¶</span>
        ğŸ€ ä½¿ã„æ–¹ãƒ’ãƒ³ãƒˆ
    </h4>
    <div class="instructions-content" id="instructions-content">
        <ul>
            <li><strong>é¸æ‰‹é…ç½®:</strong> å·¦ã®ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‹ã‚‰ã€Œé¸æ‰‹è¿½åŠ ã€ã¾ãŸã¯ã€Œç›¸æ‰‹é¸æ‰‹è¿½åŠ ã€ã‚’é¸æŠã—ã€ã‚³ãƒ¼ãƒˆä¸Šã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li><strong>å‹•ãã®çŸ¢å°:</strong> ã€Œå‹•ãçŸ¢å°ï¼ˆæ›²ç·šï¼‰ã€ã‚’é¸æŠã—ã€ã‚³ãƒ¼ãƒˆä¸Šã‚’æœ€å¤§5å›ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ  â†’ å„ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ”ãƒ³ã‚¯/ã‚·ã‚¢ãƒ³ï¼‰ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ›²ç·šã‚’èª¿æ•´</li>
            <li><strong>ãƒ‘ã‚¹çŸ¢å°:</strong> ã€Œãƒ‘ã‚¹çŸ¢å°ï¼ˆç›´ç·šï¼‰ã€ã‚’é¸æŠã—ã€å§‹ç‚¹ã¨çµ‚ç‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®ç ´ç·šçŸ¢å°ã§ãƒ‘ã‚¹ã‚’è¡¨ç¾</li>
            <li><strong>ãƒ¡ãƒ¢è¿½åŠ :</strong> ã€Œãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ ã€ã‚’é¸æŠã—ã€ã‚³ãƒ¼ãƒˆä¸Šã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¥åŠ›</li>
            <li><strong>ç·¨é›†ãƒ»ç§»å‹•:</strong> ã€Œé¸æŠãƒ¢ãƒ¼ãƒ‰ã€ã§è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç§»å‹•ã€æ›²ç·šçŸ¢å°ã®ã‚¢ãƒ³ã‚«ãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆä¸¸ï¼‰ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ›²ç·šã‚’èª¿æ•´</li>
            <li><strong>å‰Šé™¤:</strong> è¦ç´ ã‚’é¸æŠã—ã¦ã‹ã‚‰ã€Œé¸æŠã‚’å‰Šé™¤ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
        </ul>
    </div>
</div>
<script>
function toggleInstructions() {
    const content = document.getElementById('instructions-content');
    const icon = document.querySelector('.toggle-icon');
    content.classList.toggle('show');
    icon.classList.toggle('expanded');
}
</script>
<script src="{{ url_for('static', filename='js/court_editor.js') }}"></script>
{% endblock %}
